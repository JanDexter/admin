<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Service Worker - CO-Z Workspace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        p {
            color: #4a5568;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            border: none;
            font-size: 16px;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn-secondary {
            background: #48bb78;
        }
        
        .status {
            margin-top: 30px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }
        
        .status.success {
            background: #c6f6d5;
            border: 2px solid #48bb78;
            color: #22543d;
            display: block;
        }
        
        .status.error {
            background: #fed7d7;
            border: 2px solid #f56565;
            color: #742a2a;
            display: block;
        }
        
        .status.info {
            background: #bee3f8;
            border: 2px solid #4299e1;
            color: #2c5282;
            display: block;
        }
        
        .steps {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .steps ol {
            margin-left: 20px;
        }
        
        .steps li {
            margin-bottom: 10px;
            color: #4a5568;
        }
        
        .code {
            background: #2d3748;
            color: #48bb78;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Fix Login Issues</h1>
        <p>If you're experiencing issues with login redirects or seeing the offline page after logging in, click the button below to clear the Service Worker cache.</p>
        
        <div class="steps">
            <h3 style="margin-bottom: 10px; color: #2d3748;">What this will do:</h3>
            <ol>
                <li>Unregister all service workers</li>
                <li>Clear all cached data</li>
                <li>Clear local storage</li>
                <li>Reload the page with fresh data</li>
            </ol>
        </div>
        
        <button class="btn" onclick="clearEverything()">üóëÔ∏è Clear Service Worker & Cache</button>
        <button class="btn btn-secondary" onclick="checkStatus()">üìä Check SW Status</button>
        
        <div id="status" class="status"></div>
        
        <div class="code" id="details" style="display: none;"></div>
        
        <p style="margin-top: 30px; font-size: 14px; color: #718096;">
            <strong>Note:</strong> After clearing, you may need to close all browser tabs and reopen the app for changes to take full effect.
        </p>
    </div>

    <script>
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = message;
        }
        
        function showDetails(text) {
            const detailsDiv = document.getElementById('details');
            detailsDiv.style.display = 'block';
            detailsDiv.textContent = text;
        }
        
        async function clearEverything() {
            showStatus('‚è≥ Clearing service workers and caches...', 'info');
            
            try {
                // Unregister all service workers
                const registrations = await navigator.serviceWorker.getRegistrations();
                showDetails(`Found ${registrations.length} service worker(s)`);
                
                for (let registration of registrations) {
                    await registration.unregister();
                }
                
                // Clear all caches
                const cacheKeys = await caches.keys();
                showDetails(`Found ${cacheKeys.length} cache(s): ${cacheKeys.join(', ')}`);
                
                for (let key of cacheKeys) {
                    await caches.delete(key);
                }
                
                // Clear storage
                localStorage.clear();
                sessionStorage.clear();
                
                showStatus('‚úÖ Success! All service workers, caches, and storage cleared. Reloading page in 3 seconds...', 'success');
                
                setTimeout(() => {
                    window.location.href = '/';
                }, 3000);
                
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
                showDetails(error.stack);
            }
        }
        
        async function checkStatus() {
            showStatus('üîç Checking service worker status...', 'info');
            
            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                const cacheKeys = await caches.keys();
                
                let statusHTML = '<strong>Service Workers:</strong><br>';
                
                if (registrations.length === 0) {
                    statusHTML += '‚úÖ No service workers registered<br>';
                } else {
                    statusHTML += `‚ö†Ô∏è ${registrations.length} service worker(s) found:<br>`;
                    registrations.forEach((reg, i) => {
                        statusHTML += `&nbsp;&nbsp;${i + 1}. ${reg.active ? reg.active.scriptURL : 'Installing...'}<br>`;
                    });
                }
                
                statusHTML += '<br><strong>Caches:</strong><br>';
                
                if (cacheKeys.length === 0) {
                    statusHTML += '‚úÖ No caches found<br>';
                } else {
                    statusHTML += `‚ö†Ô∏è ${cacheKeys.length} cache(s) found:<br>`;
                    cacheKeys.forEach((key, i) => {
                        statusHTML += `&nbsp;&nbsp;${i + 1}. ${key}<br>`;
                    });
                }
                
                statusHTML += '<br><strong>Local Storage:</strong><br>';
                statusHTML += `üì¶ ${Object.keys(localStorage).length} item(s) stored<br>`;
                
                showStatus(statusHTML, 'info');
                
                // Check for specific version
                const hasOldVersion = cacheKeys.some(key => 
                    key.includes('v3') || key.includes('v4')
                );
                
                if (hasOldVersion) {
                    showDetails('‚ö†Ô∏è Old cache versions detected (v3 or v4). You should clear them!');
                } else if (cacheKeys.some(key => key.includes('v5'))) {
                    showDetails('‚úÖ Latest cache version (v5) detected. You\'re up to date!');
                }
                
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        // Auto-check on load
        window.addEventListener('load', () => {
            checkStatus();
        });
    </script>
</body>
</html>
